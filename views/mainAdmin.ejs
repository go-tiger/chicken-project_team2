
  <div class="container">
    <div class="row g-5">
      <div class="col-12">
        <!----------------그룹---------------->
        <h2 class="tableTitle" >유저 리스트</h2>
        <div>
        <table class="type09 mb-3">
          <thead>
          </tr>
              <th scope="cols">index</th>
              <th scope="cols">이메일</th>
              <th scope="cols">주소</th>
              <th scope="cols">핸드폰</th>
              <th scope="cols">수정</th>
              <th scope="cols">삭제</th>
          </tr>
          </thead>
          <tbody id = "userList">

          </tbody>
        </table>
        <!------------페이지네이션---------->
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center" id="adminPagination">

          </ul>
        </nav>
        <!------------페이지네이션---------->
      </div>
      </div>
    </div>
    <!----------------그룹---------------->
      <footer class="pt-5 my-5 text-muted border-top text-center">
        정기치킨주식회사 &middot; &copy; 2023
      </footer>
    </div>
  </div>
  <script>
    let query = window.location.search;
    let param = new URLSearchParams(query);
    let page = Number(param.get('page') || 1);
    const id = new URLSearchParams(location.search).get('id');

    getUserLists(page);

    function deleteUser(id) {
      let result = confirm('정말로 삭제하시겠습니까?');

      if (result) {
        $.ajax({
          type: 'DELETE',
          url: `/api/user/${id}`,
          data: {},
          success: function () {
            alert('삭제되었습니다.');
            location.reload();
          },
        });
      } else {
        alert('취소되었습니다.');
      }
    }

    function deleteUser(id) {
      let result = confirm('정말로 삭제하시겠습니까?');

      if (result) {
        $.ajax({
          type: 'DELETE',
          url: `/api/user/${id}`,
          data: {},
          success: function () {
            alert('삭제되었습니다.');
            location.reload();
          },
        });
      } else {
        alert('취소되었습니다.');
      }
    }

    function getUserLists(page) {
      $.ajax({
        type: 'GET',
        url: `/api/user/list?page=${page}`,
        data: {},
        success: function (response) {
          const { count, rows, firstPage, lastPage, totalPage } = response;
          const AdminUser = rows.map(user => {
            return `<tr>
              <td>${user.id}</td>
              <td>${user.email}</td>
              <td>${user.address}</td>
              <td>${user.phone}</td>
              <td><button type="button" class="btn btn-outline-dark"><a href="/user/${user.id}">수정</a></button></td>
              <td><button type="button" class="btn btn-outline-dark" onclick="deleteUser(${user.id})">삭제</button></td>  
            </tr>`;
          });
          $('#userList').append(AdminUser.join());

          // pagination 버튼 생성
          const pages = [];

          // prev 버튼
          if (page > 1) {
              const prev = `
                  <a href='?page=${Number(page) - 1}'><div class="pagination-btn">이전</div></a>
              `;
              pages.push(prev);
          }
          
          // pages 버튼
          for (let i = firstPage; i <= lastPage; i++) {
              const pageList =
                  Number(page) === i
                      ? `<a href='?page=${i}'><div class="pagination-btn active">${i}</div></a>`
                      : `<a href='?page=${i}'><div class="pagination-btn">${i}</div></a>`;
          
              pages.push(pageList);
          }
          
          // next 버튼
          if (page < totalPage) {
              const next = `
                  <a href='?page=${Number(page) + 1}'><div class="pagination-btn">다음</div>
              `;
              pages.push(next);
          }

          document.getElementById('adminPagination').innerHTML = pages.join('');
        },
      });
    }


  </script>
