<div class="container-fluit">
  <h4 class="tableTitle" >유저 리스트</h4>

  <table class="table table-dark table-striped" style="word-wrap:break-word;table-layout:fixed;width:100%">
    <thead>
      <tr>
        <th scope="col" style="width:5%">#</th>
        <th scope="col" style="width:7%">권한</th>
        <th scope="col" style="width:20%">이메일</th>
        <th scope="col" style="width:10%">이름</th>
        <th scope="col" style="width:18%">핸드폰</th>
        <th scope="col" style="width:20%">주소</th>
        <th scope="col" style="width:10%">수정</th>
        <th scope="col" style="width:10%">삭제</th>
      </tr>
    </thead>
    <tbody id="table-user-list" class="table-group-divider">

    </tbody>
  </table>
</div>

<script>
  $.ajax({
    type: 'GET',
    url: `/api/user/list`,
    headers: {
      Authorization: `Bearer ${tokens.accessToken}`,
      Refresh: `${tokens.refreshToken}`,
    },
    success: function (response) {
      
      const userList = response.userList.map(({ id, userType, email, userName, phone, address }) => {
        if(userType === 2){
          return ``
        } else {
          return `
            <tr>
              <th scope="row" width="1">${id}</th>
              <th scope="row" width="1">${userType === 0 ? '유저': userType === 1 ? '사장' : userType === 2 ? '관리자' : ''}</th>
              <td >${email}</td>
              <td nowrap>${userName}</td>
              <td>${phone}</td>
              <td>${address}</td>
              <td nowrap><button type="button" class="btn btn-secondary btn-sm" onclick="location.href='/admin/user/edit/${id}'">수정</button></td>
              <td nowrap><button type="button" class="btn btn-danger btn-sm" onclick="deleteUser(${id})">삭제</button></td>
            </tr>
          `
        }
      }).join('')

      $('#table-user-list').append(userList)
    },
    error: function (err){
    }
  })

  function deleteUser(id){
    if(confirm("정말 삭제 하시겠습니까? (삭제하면 뒤는 없습니다.)")){
      $.ajax({
        type: 'DELETE',
        url: `/api/user/${id}`,
        headers: {
        Authorization: `Bearer ${tokens.accessToken}`,
        Refresh: `${tokens.refreshToken}`,
        },
        success: function(response){
          alert(response.message)
        },
        error: function(err){
          alert(err.responseJSON.message)
        }
      })
    }
  }
</script>