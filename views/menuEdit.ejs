<div class="container">
  <div class="row g-5">
    <!------í˜„ì¬ë©”ë‰´í™•ì¸------>
    <div id="editMenuImage" class="editMenu col-sm-12 col-md-6 col-lg-4">
      <img src="" alt="ì´ë¯¸ì§€ ìˆ˜ì •">
    </div>
    <!------í˜„ì¬ë©”ë‰´í™•ì¸------>
    <!------ë©”ë‰´ ìˆ˜ì • í¼--------->
    <div id="editMenu" class="col-sm-12 col-md-6 col-lg-8">
      <h2>ë©”ë‰´ ìˆ˜ì •</h2>
      <form id="editMenuForm" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="menuName" class="form-label">ë©”ë‰´ ì´ë¦„</label>
          <input
            type="text"
            class="form-control"
            id="menuName"
            name="menuName"
            required/>
        </div>
        <div class="mb-3">
          <label for="file" class="form-label">ì´ë¯¸ì§€ (ì„ íƒì•ˆí• ì‹œ ê¸°ì¡´ ì´ë¯¸ì§€ ìœ ì§€)</label>
          <input 
            class="form-control" 
            type="file" 
            id="file" 
            name="file"
            accept=".png, .jpg, .jpeg, .pdf"
          />
        </div>
        <div class="mb-3">
          <label for="menuPrice" class="form-label">ê°€ê²©</label>
          <input
            type="number"
            class="form-control"
            id="menuPrice"
            name="menuPrice"
            required/>
        </div>
        <button
          type="submit"
          class="col-sm-6 col-2 btn btn-dark"
        >
          í™•ì¸
        </button>
      </form>  
    </div>
    <!-----ë©”ë‰´ ìˆ˜ì • í¼---------->
    <footer class="pt-5 my-5 text-center border-top">
      ì •ê¸°ì¹˜í‚¨ì£¼ì‹íšŒì‚¬ &middot; &copy; 2023
    </footer>
  </div>
</div>

<script>
  $(document).ready(function(){
    const menuId = extractIdFromURL()

    $.ajax({
      type: 'GET',
      url: `/api/menu/${menuId}`,
      headers: {
          'Authorization': `Bearer ${tokens.accessToken}`,
          'Refresh': `${tokens.refreshToken}`
        },
      success: function (response) {
        if(response.menu === null){
          alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë©”ë‰´ ì…ë‹ˆë‹¤.')
          window.location.href = '/admin/menu/add'
        }
        const menuName = response.menu.menuName
        const menuPhoto = response.menu.menuPhoto
        const menuPrice = response.menu.menuPrice

        $('#menuName').val(menuName);
        $('#menuPrice').val(menuPrice);
        $('#editMenuImage img').attr("src", `/uploads/${menuPhoto}`)
      },
      error: function(err){
        console.log(err)
      }
    })
  })
  
  $('#editMenuForm').submit(function(e){
    e.preventDefault();
    const menuId = extractIdFromURL()

    const menuName = $('#menuName').val();
    const menuPrice = $('#menuPrice').val();
    const file = $('#file')[0].files[0]

    let formData = new FormData();
    formData.append('file', file);
    formData.append('menuName', menuName);
    formData.append('menuPrice', menuPrice);

    $.ajax({
      type: 'PATCH',
      url: `/api/menu/${menuId}`,
      headers: {
        'Authorization': `Bearer ${tokens.accessToken}`,
        'Refresh': `${tokens.refreshToken}`
      },
      data: formData,
      contentType: false,
      processData: false,
      success: function (response) {
        alert(response.message)
        window.location.reload()
      },
      error: function(err) {
        console.log("ğŸš€ ~ file: menuEdit.ejs:116 ~ $ ~ err:", err)

      }
    })
  })

  function extractIdFromURL(){
    const url = window.location.href;
    return id = url.substr(url.lastIndexOf('/') + 1);
  }

</script>
