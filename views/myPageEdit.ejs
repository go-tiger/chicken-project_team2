<main class="form-signin w-100 m-auto container">
  <div class="row">
    <form id="form-edit-user">
      <div class="title">
        <h4>마이페이지</h4>
      </div>
      <div id="myProfile">
        
      </div>
      <hr class="col-12" />
      <button
        type="submit"
        class="btn btn-dark"
      >
        수정완료
      </button>
    </form>
  </div>
</main>

<script>
  const {address, email, phone, userName: name } = JSON.parse(sessionStorage.getItem("user"))
  
  
  const editUserHTML = `
    <div class="mb-3 row">
      <label for="staticEmail" class="col-12 col-form-label">이메일</label>
      <div class="col-sm-10">
        <input
          type="text"
          readonly
          class="form-control-plaintext"
          id="staticEmail"
          value="${email}"
        />
      </div>
    </div>
    <hr class="col-12" />
    <div class="mb-3 row">
      <label for="staticName" class="col-12 col-form-label">이름</label>
      <div class="col-sm-10">
        <input
          type="text"
          class="form-control"
          id="userName"
          value="${name}"
        />
      </div>
    </div>
    <hr class="col-12" />
    <div class="mb-3 row">
      <label for="inputAddress" class="col-12 col-form-label">주소</label>
      <div class="col-sm-10">
        <input
          type="text"
          class="form-control"
          id="userAddress"
          value="${address}"
        />
      </div>
    </div>
    <hr class="col-12" />
    <div class="mb-3 row">
      <label for="inputPhone" class="col-12 col-form-label">핸드폰</label>
      <div class="col-sm-10">
        <input
          type="text"
          class="form-control"
          id="userPhone"
          value="${phone}"
        />
      </div>
    </div>
  `;
  $('#myProfile').append(editUserHTML);
  
  $('#form-edit-user').submit(function(e){
    e.preventDefault();

    const name = $('#userName').val()
    const email = $('#userEmail').val()
    const phone = $('#userPhone').val()
    const address = $('#userAddress').val()


    //POST 요청 수정하기
    $.ajax({
      type : 'PUT',
      url : `/api/user`,
      headers: {
        'Authorization': `Bearer ${tokens.accessToken}`,
        'Refresh': `${tokens.refreshToken}`
      },
      data: {
        name,
        phone,
        address
      },
      success: function(response){
        alert(response.message)
        sessionStorage.removeItem("user")
        window.location.href="/mypage"
      },
      error: function(err){
        alert(err.responseJSON.message)
      },
    })
  })

</script>